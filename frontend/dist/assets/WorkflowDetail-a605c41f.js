import{_ as V,s as M,u as G,a as O,r as k,c as A,o as j,b as o,d as i,e as s,t as n,n as g,l as d,f as r,F as w,k as y,p as b}from"./index-6e83d327.js";const H={class:"workflow-detail-page"},J={class:"page-header"},K={class:"header-content"},Q={class:"header-left"},U={key:0},X={class:"workflow-meta"},Y={key:0,class:"template-badge"},Z={key:0,class:"header-actions"},ss={key:0,class:"page-content"},es={class:"info-section"},ts={class:"info-grid"},ls={class:"info-card"},os={class:"info-card"},is={class:"info-card"},as={class:"info-card"},ns={class:"info-card"},rs={class:"info-card"},ds={class:"flow-section"},us={class:"workflow-flow"},cs={class:"step-icon"},vs={key:0,class:"lucide-circle"},ps={key:1,class:"lucide-check-circle"},fs={key:2,class:"lucide-circle-dot"},_s={class:"step-content"},ms={key:0},ks={class:"step-meta"},gs={key:0,class:"step-type initial"},ws={key:1,class:"step-type final"},ys={key:2,class:"step-type"},hs={key:0,class:"step-arrow"},bs={key:0,class:"transitions-section"},Cs={class:"transitions-grid"},Es={class:"transition-flow"},$s={class:"state-from"},Ds={class:"state-to"},Ns={class:"transition-details"},Is={key:0},Ls={class:"transition-meta"},As={key:0,class:"meta-tag approval"},Fs={key:1,class:"meta-tag automatic"},Rs={key:1,class:"approval-section"},Ss={class:"approval-levels"},Ts={class:"level-number"},Ws={class:"level-content"},Ps={class:"level-details"},qs={key:0,class:"detail-item"},xs={key:1,class:"detail-item"},zs={key:2,class:"detail-item"},Bs={class:"config-section"},Vs={class:"config-grid"},Ms={key:0,class:"config-card"},Gs={class:"config-details"},Os={key:1,class:"config-card"},js={class:"config-details"},Hs={key:0},Js={key:1},Ks={class:"config-card"},Qs={class:"config-details"},Us={class:"instances-section"},Xs={key:0,class:"instances-list"},Ys=["onClick"],Zs={class:"instance-info"},se={class:"instance-status"},ee={key:1,class:"empty-instances"},te={key:1,class:"loading-state"},le={key:2,class:"error-state"},oe={__name:"WorkflowDetail",setup(ie){const C=M(),p=G(),h=O(),t=k(null),f=k([]),_=k(!1),m=k(null),F=A(()=>{var u,c;return t.value?({solicitante:1,tecnico:2,supervisor:3,administrador:4}[(u=h.user)==null?void 0:u.perfil]||0)>=4?!0:t.value.user_id===((c=h.user)==null?void 0:c.id):!1}),R=A(()=>{var e;return!t.value||!t.value.ativo?!1:{solicitante:1,tecnico:2,supervisor:3,administrador:4}[(e=h.user)==null?void 0:e.perfil]>=2}),E=async()=>{var a,e;try{_.value=!0,m.value=null;const u=await b.get(`/workflows/${C.params.id}`);t.value=u.data.workflow,await $()}catch(u){console.error("Erro ao carregar workflow:",u),m.value=((e=(a=u.response)==null?void 0:a.data)==null?void 0:e.message)||"Erro ao carregar workflow"}finally{_.value=!1}},$=async()=>{try{const a=await b.get(`/workflows/${C.params.id}/instances`,{params:{limit:10}});f.value=a.data.instances||[]}catch(a){console.error("Erro ao carregar instâncias:",a),f.value=[]}},S=()=>{p.push(`/workflows/${t.value.id}/edit`)},T=async()=>{try{const a=await b.post(`/workflows/${t.value.id}/duplicate`);a.data.success&&p.push(`/workflows/${a.data.data.id}/edit`)}catch(a){console.error("Erro ao duplicar workflow:",a)}},W=()=>{p.push({path:"/workflow-instances/create",query:{workflow:t.value.id}})},P=a=>{p.push(`/workflow-instances/${a.id}`)},D=a=>{var u,c;const e=(c=(u=t.value)==null?void 0:u.estados)==null?void 0:c.find(l=>l.id===a);return(e==null?void 0:e.nome)||a},q=a=>({operacional:"Operacional",financeiro:"Financeiro",emergencial:"Emergencial",administrativo:"Administrativo"})[a]||a,x=a=>new Intl.NumberFormat("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a),z=a=>new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),B=a=>`Departamento ${a}`;return j(()=>{E()}),(a,e)=>{var u,c;return o(),i("div",H,[s("header",J,[s("div",K,[s("div",Q,[s("button",{class:"btn-back",onClick:e[0]||(e[0]=l=>a.$router.go(-1))},e[1]||(e[1]=[s("i",{class:"lucide-arrow-left"},null,-1)])),t.value?(o(),i("div",U,[s("h1",null,n(t.value.nome),1),s("div",X,[s("span",{class:g(["category-badge",`category-${t.value.categoria}`])},n(q(t.value.categoria)),3),s("span",{class:g(["status-badge",{active:t.value.ativo,inactive:!t.value.ativo}])},n(t.value.ativo?"Ativo":"Inativo"),3),t.value.template?(o(),i("span",Y,"Template")):d("",!0)])])):d("",!0)]),t.value?(o(),i("div",Z,[s("button",{class:"btn btn-outline",onClick:T},e[2]||(e[2]=[s("i",{class:"lucide-copy"},null,-1),r(" Duplicar ",-1)])),F.value?(o(),i("button",{key:0,class:"btn btn-secondary",onClick:S},e[3]||(e[3]=[s("i",{class:"lucide-edit"},null,-1),r(" Editar ",-1)]))):d("",!0),R.value?(o(),i("button",{key:1,class:"btn btn-primary",onClick:W},e[4]||(e[4]=[s("i",{class:"lucide-play"},null,-1),r(" Executar ",-1)]))):d("",!0)])):d("",!0)])]),!_.value&&t.value?(o(),i("div",ss,[s("div",es,[e[11]||(e[11]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"lucide-info"}),r(" Informações Gerais ")])],-1)),s("div",ts,[s("div",ls,[e[5]||(e[5]=s("h3",null,"Descrição",-1)),s("p",null,n(t.value.descricao||"Sem descrição"),1)]),s("div",os,[e[6]||(e[6]=s("h3",null,"Tipo",-1)),s("p",null,n(t.value.tipo||"Não especificado"),1)]),s("div",is,[e[7]||(e[7]=s("h3",null,"Prazo Máximo",-1)),s("p",null,n(t.value.prazo_maximo)+" horas",1)]),s("div",as,[e[8]||(e[8]=s("h3",null,"Prioridade Padrão",-1)),s("p",null,n(t.value.prioridade_padrao||"Normal"),1)]),s("div",ns,[e[9]||(e[9]=s("h3",null,"Trigger",-1)),s("p",null,n(t.value.trigger_evento||"Manual"),1)]),s("div",rs,[e[10]||(e[10]=s("h3",null,"Versão",-1)),s("p",null,"v"+n(t.value.versao),1)])])]),s("div",ds,[e[13]||(e[13]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"lucide-git-branch"}),r(" Fluxo do Workflow ")])],-1)),s("div",us,[(o(!0),i(w,null,y(t.value.estados,(l,v)=>{var N,I,L;return o(),i("div",{key:l.id,class:g(["flow-step",{initial:l.id===t.value.estado_inicial,final:(N=t.value.estados_finais)==null?void 0:N.includes(l.id)}])},[s("div",cs,[l.id===t.value.estado_inicial?(o(),i("i",vs)):(I=t.value.estados_finais)!=null&&I.includes(l.id)?(o(),i("i",ps)):(o(),i("i",fs))]),s("div",_s,[s("h4",null,n(l.nome),1),l.descricao?(o(),i("p",ms,n(l.descricao),1)):d("",!0),s("div",ks,[l.id===t.value.estado_inicial?(o(),i("span",gs," Estado Inicial ")):(L=t.value.estados_finais)!=null&&L.includes(l.id)?(o(),i("span",ws," Estado Final ")):(o(),i("span",ys,"Estado Intermediário"))])]),v<t.value.estados.length-1?(o(),i("div",hs,[...e[12]||(e[12]=[s("i",{class:"lucide-arrow-down"},null,-1)])])):d("",!0)],2)}),128))])]),(u=t.value.transicoes)!=null&&u.length?(o(),i("div",bs,[e[18]||(e[18]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"lucide-shuffle"}),r(" Transições Disponíveis ")])],-1)),s("div",Cs,[(o(!0),i(w,null,y(t.value.transicoes,l=>(o(),i("div",{key:`${l.de}-${l.para}`,class:"transition-card"},[s("div",Es,[s("div",$s,n(D(l.de)),1),e[14]||(e[14]=s("div",{class:"arrow"},[s("i",{class:"lucide-arrow-right"})],-1)),s("div",Ds,n(D(l.para)),1)]),s("div",Ns,[s("h4",null,n(l.nome||"Transição"),1),l.condicao?(o(),i("p",Is,[e[15]||(e[15]=s("strong",null,"Condição:",-1)),r(" "+n(l.condicao),1)])):d("",!0),s("div",Ls,[l.requer_aprovacao?(o(),i("span",As,[...e[16]||(e[16]=[s("i",{class:"lucide-user-check"},null,-1),r(" Requer Aprovação ",-1)])])):d("",!0),l.automatica?(o(),i("span",Fs,[...e[17]||(e[17]=[s("i",{class:"lucide-zap"},null,-1),r(" Automática ",-1)])])):d("",!0)])])]))),128))])])):d("",!0),(c=t.value.niveis_aprovacao)!=null&&c.length?(o(),i("div",Rs,[e[22]||(e[22]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"lucide-user-check"}),r(" Níveis de Aprovação ")])],-1)),s("div",Ss,[(o(!0),i(w,null,y(t.value.niveis_aprovacao,(l,v)=>(o(),i("div",{key:v,class:"approval-level"},[s("div",Ts,n(v+1),1),s("div",Ws,[s("h4",null,n(l.nome||`Nível ${v+1}`),1),s("div",Ps,[l.perfil_requerido?(o(),i("div",qs,[e[19]||(e[19]=s("label",null,"Perfil Requerido:",-1)),s("span",null,n(l.perfil_requerido),1)])):d("",!0),l.valor_limite?(o(),i("div",xs,[e[20]||(e[20]=s("label",null,"Valor Limite:",-1)),s("span",null,"R$ "+n(x(l.valor_limite)),1)])):d("",!0),l.departamento_id?(o(),i("div",zs,[e[21]||(e[21]=s("label",null,"Departamento:",-1)),s("span",null,n(B(l.departamento_id)),1)])):d("",!0)])])]))),128))])])):d("",!0),s("div",Bs,[e[32]||(e[32]=s("div",{class:"section-header"},[s("h2",null,[s("i",{class:"lucide-settings"}),r(" Configurações Avançadas ")])],-1)),s("div",Vs,[t.value.escalacao_config?(o(),i("div",Ms,[e[25]||(e[25]=s("h3",null,[s("i",{class:"lucide-trending-up"}),r(" Escalação ")],-1)),s("div",Gs,[s("p",null,[e[23]||(e[23]=s("strong",null,"Tempo:",-1)),r(" "+n(t.value.escalacao_config.tempo_escalacao)+"h",1)]),s("p",null,[e[24]||(e[24]=s("strong",null,"Para:",-1)),r(" "+n(t.value.escalacao_config.escalar_para),1)])])])):d("",!0),t.value.notificacoes_config?(o(),i("div",Os,[e[28]||(e[28]=s("h3",null,[s("i",{class:"lucide-bell"}),r(" Notificações ")],-1)),s("div",js,[t.value.notificacoes_config.email?(o(),i("p",Hs,e[26]||(e[26]=[s("i",{class:"lucide-mail"},null,-1),r(" Email habilitado ",-1)]))):d("",!0),t.value.notificacoes_config.sistema?(o(),i("p",Js,e[27]||(e[27]=[s("i",{class:"lucide-monitor"},null,-1),r(" Sistema habilitado ",-1)]))):d("",!0)])])):d("",!0),s("div",Ks,[e[31]||(e[31]=s("h3",null,[s("i",{class:"lucide-shield"}),r(" Permissões ")],-1)),s("div",Qs,[s("p",null,[e[29]||(e[29]=s("strong",null,"Público:",-1)),r(" "+n(t.value.publico?"Sim":"Não"),1)]),s("p",null,[e[30]||(e[30]=s("strong",null,"Criador:",-1)),r(" "+n(t.value.user_id),1)])])])])]),s("div",Us,[s("div",{class:"section-header"},[e[34]||(e[34]=s("h2",null,[s("i",{class:"lucide-history"}),r(" Instâncias Recentes ")],-1)),s("button",{class:"btn btn-outline btn-sm",onClick:$},e[33]||(e[33]=[s("i",{class:"lucide-refresh-cw"},null,-1),r(" Atualizar ",-1)]))]),f.value.length>0?(o(),i("div",Xs,[(o(!0),i(w,null,y(f.value,l=>(o(),i("div",{key:l.id,class:"instance-item",onClick:v=>P(l)},[s("div",Zs,[s("h4",null,"Instância #"+n(l.id),1),s("p",null,n(l.titulo||"Sem título"),1)]),s("div",se,[s("span",{class:g(["status-badge",`status-${l.status}`])},n(l.status),3),s("small",null,n(z(l.created_at)),1)])],8,Ys))),128))])):(o(),i("div",ee,e[35]||(e[35]=[s("p",null,"Nenhuma instância encontrada para este workflow.",-1)])))])])):d("",!0),_.value?(o(),i("div",te,e[36]||(e[36]=[s("div",{class:"spinner"},null,-1),s("p",null,"Carregando workflow...",-1)]))):d("",!0),m.value?(o(),i("div",le,[e[38]||(e[38]=s("div",{class:"error-icon"},[s("i",{class:"lucide-alert-circle"})],-1)),e[39]||(e[39]=s("h3",null,"Erro ao carregar workflow",-1)),s("p",null,n(m.value),1),s("button",{class:"btn btn-primary",onClick:E},e[37]||(e[37]=[s("i",{class:"lucide-refresh-cw"},null,-1),r(" Tentar Novamente ",-1)]))])):d("",!0)])}}},ne=V(oe,[["__scopeId","data-v-6a8b7cbe"],["__file","C:/Manutencao/frontend/src/pages/WorkflowDetail.vue"]]);export{ne as default};
