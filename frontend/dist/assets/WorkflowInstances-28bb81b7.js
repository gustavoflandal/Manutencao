import{_ as ce,u as ve,a as pe,r as p,c as A,w as fe,o as me,b as o,d as l,e as s,n as b,f as k,g as I,v as O,h as G,i as N,j as H,F as L,k as R,l as f,t as n,m as j,p as W,q as _e}from"./index-6e83d327.js";const be={class:"workflow-instances-page"},ke={class:"page-header"},we={class:"header-content"},ge={class:"header-actions"},ye=["disabled"],Ce={class:"page-content"},he={class:"filters-section"},xe={class:"search-bar"},Ae={class:"search-input"},Ie={class:"filters"},je=["value"],$e={key:0,class:"loading-state"},Se={key:1,class:"empty-state"},Te={key:0},De={key:1},Me={key:2,class:"instances-list"},Pe=["onClick"],Ve={class:"card-header"},Ee={class:"instance-info"},Ne={class:"instance-title"},Le={class:"instance-id"},Re={class:"instance-meta"},We={class:"creator"},ze={class:"creation-date"},Be={class:"card-actions"},qe={class:"progress-section"},Fe={class:"progress-info"},Ue={class:"progress-text"},Oe={class:"progress-percentage"},Ge={class:"progress-bar"},He={class:"instance-details"},Je={key:0,class:"detail-item"},Ke={key:1,class:"detail-item"},Qe={key:2,class:"detail-item"},Xe={class:"quick-actions"},Ye=["onClick"],Ze=["onClick"],ea=["onClick"],aa=["onClick"],sa={key:3,class:"pagination"},ta=["disabled"],oa={class:"page-numbers"},la=["onClick"],na=["disabled"],ra={class:"modal-header"},ia={class:"modal-body"},da={key:0,class:"form-group"},ua={class:"modal-footer"},ca=["disabled"],va={__name:"WorkflowInstances",setup(pa){const J=ve(),u=pe(),w=p([]),D=p([]),g=p(!1),_=p(""),c=p(1),M=p(12),y=p(!1),i=p({}),C=p(!1),d=p({status:"",workflow_id:"",prioridade:""}),$=A(()=>{let a=[...w.value];if(_.value){const e=_.value.toLowerCase();a=a.filter(t=>{var r,m,v,x;return t.id.toString().includes(e)||((m=(r=t.workflow)==null?void 0:r.nome)==null?void 0:m.toLowerCase().includes(e))||((v=t.solicitacao_id)==null?void 0:v.toString().includes(e))||((x=t.observacoes)==null?void 0:x.toLowerCase().includes(e))})}return d.value.status&&(a=a.filter(e=>e.status_atual===d.value.status)),d.value.workflow_id&&(a=a.filter(e=>e.workflow_id==d.value.workflow_id)),d.value.prioridade&&(a=a.filter(e=>e.prioridade===d.value.prioridade)),a}),K=A(()=>{const a=(c.value-1)*M.value,e=a+M.value;return $.value.slice(a,e)}),S=A(()=>Math.ceil($.value.length/M.value)),Q=A(()=>{const a=[],e=Math.max(1,c.value-2),t=Math.min(S.value,e+4);for(let r=e;r<=t;r++)a.push(r);return a}),P=A(()=>Object.values(d.value).some(a=>a!==""));fe($,()=>{c.value=1});const z=((a,e)=>{let t;return function(...m){const v=()=>{clearTimeout(t),a(...m)};clearTimeout(t),t=setTimeout(v,e)}})(()=>{h()},300),B=async()=>{try{g.value=!0;const a=await W.get("/workflows/instances");a.data.success&&(w.value=a.data.instances||[])}catch(a){console.error("Erro ao carregar instâncias:",a),w.value=[]}finally{g.value=!1}},X=async()=>{try{const a=await W.get("/workflows");a.data.success&&(D.value=a.data.workflows||[])}catch(a){console.error("Erro ao carregar workflows:",a),D.value=[]}},Y=()=>{B()},h=()=>{c.value=1},Z=()=>{d.value={status:"",workflow_id:"",prioridade:""},_.value="",h()},V=a=>{a>=1&&a<=S.value&&(c.value=a)},q=a=>{J.push(`/workflows/instances/${a.id}`)},ee=a=>({em_andamento:"status-in-progress",aguardando_aprovacao:"status-pending",aprovado:"status-approved",rejeitado:"status-rejected",cancelado:"status-cancelled",expirado:"status-expired"})[a]||"",ae=a=>({em_andamento:"Em Andamento",aguardando_aprovacao:"Aguardando Aprovação",aprovado:"Aprovado",rejeitado:"Rejeitado",cancelado:"Cancelado",expirado:"Expirado"})[a]||a,se=a=>({baixa:"Baixa",normal:"Normal",alta:"Alta",critica:"Crítica"})[a]||a,F=a=>{if(!a.workflow||!a.workflow.estados)return 0;const e=a.workflow.estados,t=e.findIndex(r=>r.id===a.estado_atual);return t===-1?0:Math.round((t+1)/e.length*100)},U=a=>a?new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"",te=a=>a?new Date(a)<new Date:!1,oe=a=>a.status_atual==="aguardando_aprovacao"&&u.user&&(u.user.perfil==="supervisor"||u.user.perfil==="administrador"),le=a=>a.status_atual==="aguardando_aprovacao"&&u.user&&(u.user.perfil==="supervisor"||u.user.perfil==="administrador"),ne=a=>{var e;return["em_andamento","aguardando_aprovacao"].includes(a.status_atual)&&u.user&&(((e=a.criado_por)==null?void 0:e.id)===u.user.id||u.user.perfil==="supervisor"||u.user.perfil==="administrador")},re=a=>{i.value={type:"approve",instance:a,title:"Aprovar Instância",message:`Deseja aprovar a instância #${a.id}?`,confirmText:"Aprovar",confirmClass:"btn-primary",reason:""},y.value=!0},ie=a=>{i.value={type:"reject",instance:a,title:"Rejeitar Instância",message:`Deseja rejeitar a instância #${a.id}?`,confirmText:"Rejeitar",confirmClass:"btn-danger",reason:""},y.value=!0},de=a=>{i.value={type:"cancel",instance:a,title:"Cancelar Instância",message:`Deseja cancelar a instância #${a.id}?`,confirmText:"Cancelar",confirmClass:"btn-warning",reason:""},y.value=!0},ue=async()=>{try{C.value=!0;const{type:a,instance:e,reason:t}=i.value,r=`/workflows/instances/${e.id}/${a}`,m=t?{motivo:t}:{};if((await W.post(r,m)).data.success){const x=w.value.findIndex(E=>E.id===e.id);if(x!==-1){const E=a==="approve"?"aprovado":a==="reject"?"rejeitado":"cancelado";w.value[x].status_atual=E}T()}}catch(a){console.error(`Erro ao ${i.value.type} instância:`,a)}finally{C.value=!1}},T=()=>{y.value=!1,i.value={},C.value=!1};return me(()=>{B(),X()}),(a,e)=>(o(),l("div",be,[s("header",ke,[s("div",we,[e[10]||(e[10]=s("div",{class:"header-left"},[s("h1",null,"Instâncias de Workflow"),s("p",{class:"subtitle"},"Acompanhe o progresso dos workflows em execução")],-1)),s("div",ge,[s("button",{class:"btn btn-outline",onClick:Y,disabled:g.value},[s("i",{class:b(["lucide-refresh-cw",{spinning:g.value}])},null,2),e[9]||(e[9]=k(" Atualizar ",-1))],8,ye)])])]),s("div",Ce,[s("div",he,[s("div",xe,[s("div",Ae,[e[11]||(e[11]=s("i",{class:"lucide-search"},null,-1)),I(s("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>_.value=t),placeholder:"Buscar por ID, workflow ou solicitação...",onInput:e[1]||(e[1]=(...t)=>G(z)&&G(z)(...t))},null,544),[[O,_.value]])])]),s("div",Ie,[I(s("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>d.value.status=t),onChange:h},e[12]||(e[12]=[H('<option value="" data-v-fa9bfda7>Todos os Status</option><option value="em_andamento" data-v-fa9bfda7>Em Andamento</option><option value="aguardando_aprovacao" data-v-fa9bfda7>Aguardando Aprovação</option><option value="aprovado" data-v-fa9bfda7>Aprovado</option><option value="rejeitado" data-v-fa9bfda7>Rejeitado</option><option value="cancelado" data-v-fa9bfda7>Cancelado</option><option value="expirado" data-v-fa9bfda7>Expirado</option>',7)]),544),[[N,d.value.status]]),I(s("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>d.value.workflow_id=t),onChange:h},[e[13]||(e[13]=s("option",{value:""},"Todos os Workflows",-1)),(o(!0),l(L,null,R(D.value,t=>(o(),l("option",{key:t.id,value:t.id},n(t.nome),9,je))),128))],544),[[N,d.value.workflow_id]]),I(s("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>d.value.prioridade=t),onChange:h},e[14]||(e[14]=[H('<option value="" data-v-fa9bfda7>Todas as Prioridades</option><option value="baixa" data-v-fa9bfda7>Baixa</option><option value="normal" data-v-fa9bfda7>Normal</option><option value="alta" data-v-fa9bfda7>Alta</option><option value="critica" data-v-fa9bfda7>Crítica</option>',5)]),544),[[N,d.value.prioridade]]),P.value?(o(),l("button",{key:0,class:"btn btn-outline",onClick:Z},e[15]||(e[15]=[s("i",{class:"lucide-x"},null,-1),k(" Limpar ",-1)]))):f("",!0)])]),g.value?(o(),l("div",$e,e[16]||(e[16]=[s("div",{class:"spinner"},null,-1),s("p",null,"Carregando instâncias...",-1)]))):$.value.length===0?(o(),l("div",Se,[e[17]||(e[17]=s("div",{class:"empty-icon"},[s("i",{class:"lucide-workflow"})],-1)),s("h3",null,n(_.value||P.value?"Nenhuma instância encontrada":"Nenhuma instância criada"),1),!_.value&&!P.value?(o(),l("p",Te," As instâncias de workflow aparecerão aqui quando forem criadas ")):(o(),l("p",De," Tente ajustar os filtros ou termos de busca "))])):(o(),l("div",Me,[(o(!0),l(L,null,R(K.value,t=>{var r,m;return o(),l("div",{key:t.id,class:b(["instance-card",ee(t.status_atual)]),onClick:v=>q(t)},[s("div",Ve,[s("div",Ee,[s("div",Ne,[s("h3",null,n(((r=t.workflow)==null?void 0:r.nome)||"Workflow não encontrado"),1),s("span",Le,"#"+n(t.id),1)]),s("div",Re,[s("span",We,[e[18]||(e[18]=s("i",{class:"lucide-user"},null,-1)),k(" "+n(((m=t.criado_por)==null?void 0:m.nome)||"Usuário não encontrado"),1)]),s("span",ze,[e[19]||(e[19]=s("i",{class:"lucide-calendar"},null,-1)),k(" "+n(U(t.criado_em)),1)])])]),s("div",Be,[s("span",{class:b(["priority-badge",`priority-${t.prioridade}`])},n(se(t.prioridade)),3),s("span",{class:b(["status-badge",`status-${t.status_atual}`])},n(ae(t.status_atual)),3)])]),s("div",qe,[s("div",Fe,[s("span",Ue," Estado: "+n(t.estado_atual||"Não definido"),1),s("span",Oe,n(F(t))+"% ",1)]),s("div",Ge,[s("div",{class:"progress-fill",style:_e({width:`${F(t)}%`})},null,4)])]),s("div",He,[t.solicitacao_id?(o(),l("div",Je,[e[20]||(e[20]=s("i",{class:"lucide-file-text"},null,-1)),s("span",null,"Solicitação: #"+n(t.solicitacao_id),1)])):f("",!0),t.observacoes?(o(),l("div",Ke,[e[21]||(e[21]=s("i",{class:"lucide-message-square"},null,-1)),s("span",null,n(t.observacoes),1)])):f("",!0),t.prazo_conclusao?(o(),l("div",Qe,[e[22]||(e[22]=s("i",{class:"lucide-clock"},null,-1)),s("span",{class:b(["deadline",{overdue:te(t.prazo_conclusao)}])}," Prazo: "+n(U(t.prazo_conclusao)),3)])):f("",!0)]),s("div",Xe,[s("button",{class:"btn btn-sm btn-outline",onClick:j(v=>q(t),["stop"]),title:"Ver detalhes"},[...e[23]||(e[23]=[s("i",{class:"lucide-eye"},null,-1)])],8,Ye),oe(t)?(o(),l("button",{key:0,class:"btn btn-sm btn-primary",onClick:j(v=>re(t),["stop"]),title:"Aprovar"},[...e[24]||(e[24]=[s("i",{class:"lucide-check"},null,-1)])],8,Ze)):f("",!0),le(t)?(o(),l("button",{key:1,class:"btn btn-sm btn-danger",onClick:j(v=>ie(t),["stop"]),title:"Rejeitar"},[...e[25]||(e[25]=[s("i",{class:"lucide-x"},null,-1)])],8,ea)):f("",!0),ne(t)?(o(),l("button",{key:2,class:"btn btn-sm btn-warning",onClick:j(v=>de(t),["stop"]),title:"Cancelar"},[...e[26]||(e[26]=[s("i",{class:"lucide-square"},null,-1)])],8,aa)):f("",!0)])],10,Pe)}),128))])),S.value>1?(o(),l("div",sa,[s("button",{class:"btn btn-outline",onClick:e[5]||(e[5]=t=>V(c.value-1)),disabled:c.value===1},e[27]||(e[27]=[s("i",{class:"lucide-chevron-left"},null,-1),k(" Anterior ",-1)]),8,ta),s("div",oa,[(o(!0),l(L,null,R(Q.value,t=>(o(),l("button",{key:t,class:b(["page-btn",{active:t===c.value}]),onClick:r=>V(t)},n(t),11,la))),128))]),s("button",{class:"btn btn-outline",onClick:e[6]||(e[6]=t=>V(c.value+1)),disabled:c.value===S.value},e[28]||(e[28]=[k(" Próxima ",-1),s("i",{class:"lucide-chevron-right"},null,-1)]),8,na)])):f("",!0)]),y.value?(o(),l("div",{key:0,class:"modal-overlay",onClick:T},[s("div",{class:"modal-content",onClick:e[8]||(e[8]=j(()=>{},["stop"]))},[s("header",ra,[s("h3",null,n(i.value.title),1),s("button",{class:"btn-close",onClick:T},e[29]||(e[29]=[s("i",{class:"lucide-x"},null,-1)]))]),s("div",ia,[s("p",null,n(i.value.message),1),i.value.type==="reject"||i.value.type==="cancel"?(o(),l("div",da,[e[30]||(e[30]=s("label",null,"Motivo (opcional):",-1)),I(s("textarea",{"onUpdate:modelValue":e[7]||(e[7]=t=>i.value.reason=t),rows:"3",placeholder:"Descreva o motivo da ação..."},null,512),[[O,i.value.reason]])])):f("",!0)]),s("footer",ua,[s("button",{class:"btn btn-outline",onClick:T}," Cancelar "),s("button",{class:b(["btn",i.value.confirmClass]),onClick:ue,disabled:C.value},n(C.value?"Processando...":i.value.confirmText),11,ca)])])])):f("",!0)]))}},_a=ce(va,[["__scopeId","data-v-fa9bfda7"],["__file","C:/Manutencao/frontend/src/pages/WorkflowInstances.vue"]]);export{_a as default};
