import{_ as Z,s as oo,u as eo,a as so,r as m,c as R,w as z,o as ao,b as i,d as n,e,t as v,f as c,F as y,k as h,g as d,v as p,i as _,j as q,x as b,l as k,p as E,n as A}from"./index-6e83d327.js";const lo={class:"workflow-form-page"},to={class:"page-header"},io={class:"header-content"},no={class:"header-left"},ro={class:"subtitle"},uo={class:"header-actions"},co=["disabled"],vo=["disabled"],po={class:"page-content"},mo={class:"steps-progress"},fo=["onClick"],_o={class:"step-number"},bo={key:0,class:"lucide-check"},ko={key:1},go={class:"step-info"},wo={class:"form-section"},yo={key:0,class:"step-content"},ho={class:"form-grid"},Vo={class:"form-group full-width"},xo={class:"form-group full-width"},Uo={class:"form-group"},Co={class:"form-group"},Eo={class:"form-group"},Ao={class:"form-group"},No={class:"form-group"},So={class:"form-group"},qo={class:"checkbox-label"},To={key:1,class:"step-content"},$o={class:"estados-list"},Do={class:"estado-header"},Ro={class:"estado-icon"},zo={key:0,class:"lucide-circle"},Wo={key:1,class:"lucide-check-circle"},Mo={key:2,class:"lucide-circle-dot"},Po={class:"estado-info"},Fo=["onUpdate:modelValue"],Bo=["onUpdate:modelValue"],Io={class:"estado-actions"},Oo=["onClick"],jo=["onClick"],Lo=["onClick"],Ho={key:2,class:"step-content"},Go={class:"transicoes-list"},Qo={class:"transicao-flow"},Jo=["onUpdate:modelValue"],Ko=["value"],Xo=["onUpdate:modelValue"],Yo=["value","disabled"],Zo={class:"transicao-details"},oe={class:"form-row"},ee={class:"form-group"},se=["onUpdate:modelValue"],ae={class:"form-group"},le=["onUpdate:modelValue"],te={class:"form-row"},ie={class:"form-group"},ne={class:"checkbox-label"},de=["onUpdate:modelValue"],re={class:"form-group"},ue={class:"checkbox-label"},ce=["onUpdate:modelValue"],ve={class:"form-group"},pe=["onClick"],me={key:3,class:"step-content"},fe={class:"config-section"},_e={class:"niveis-aprovacao"},be={class:"nivel-number"},ke={class:"nivel-content"},ge={class:"form-row"},we={class:"form-group"},ye=["onUpdate:modelValue"],he={class:"form-group"},Ve=["onUpdate:modelValue"],xe={class:"form-group"},Ue=["onUpdate:modelValue"],Ce={class:"form-group"},Ee=["onClick"],Ae={class:"config-section"},Ne={class:"form-row"},Se={class:"form-group"},qe={class:"checkbox-label"},Te={key:0,class:"escalacao-config"},$e={class:"form-row"},De={class:"form-group"},Re={class:"form-group"},ze={class:"config-section"},We={class:"form-row"},Me={class:"form-group"},Pe={class:"checkbox-label"},Fe={key:0,class:"notificacoes-config"},Be={class:"form-row"},Ie={class:"form-group"},Oe={class:"checkbox-label"},je={class:"form-group"},Le={class:"checkbox-label"},He={class:"form-navigation"},Ge=["disabled"],Qe={class:"step-indicator"},Je=["disabled"],Ke={__name:"WorkflowForm",setup(Xe){const f=oo(),N=eo(),W=so(),r=m(0),V=m(!1),x=m(null),C=m(!1),T=m(null),g=m(!1),w=m(!1),U=m([{key:"basic",title:"Informações Básicas",description:"Nome, categoria e configurações gerais",optional:!1},{key:"states",title:"Estados",description:"Definir estados do workflow",optional:!1},{key:"transitions",title:"Transições",description:"Conectar estados com transições",optional:!1},{key:"advanced",title:"Configurações",description:"Aprovações, escalação e notificações",optional:!0}]),a=m({nome:"",descricao:"",categoria:"",tipo:"",trigger_evento:"manual",prazo_maximo:24,prioridade_padrao:"normal",publico:!1,ativo:!0,template:!1,estado_inicial:"",estados_finais:[],estados:[],transicoes:[],niveis_aprovacao:[],escalacao_config:{tempo_escalacao:24,escalar_para:"supervisor"},notificacoes_config:{email:!0,sistema:!0}}),M=R(()=>{const t=a.value.nome&&a.value.categoria&&a.value.prazo_maximo,o=a.value.estados.length>=2&&a.value.estado_inicial&&a.value.estados_finais.length>0,s=a.value.transicoes.length>0;return t&&o&&s}),$=R(()=>{switch(r.value){case 0:return a.value.nome&&a.value.categoria&&a.value.prazo_maximo;case 1:return a.value.estados.length>=2&&a.value.estado_inicial&&a.value.estados_finais.length>0;case 2:return a.value.transicoes.length>0;case 3:return!0;default:return!1}});z(g,t=>{t?a.value.escalacao_config={tempo_escalacao:24,escalar_para:"supervisor"}:a.value.escalacao_config=null}),z(w,t=>{t?a.value.notificacoes_config={email:!0,sistema:!0}:a.value.notificacoes_config=null});const P=async t=>{try{const o=await E.get(`/workflows/templates/${t}`);x.value=o.data.template,Object.assign(a.value,{...x.value,nome:`${x.value.nome} - Cópia`,template:!1,publico:!1,id:void 0}),g.value=!!a.value.escalacao_config,w.value=!!a.value.notificacoes_config}catch(o){console.error("Erro ao carregar template:",o)}},F=async t=>{try{const s=(await E.get(`/workflows/${t}`)).data.workflow;Object.assign(a.value,s),g.value=!!s.escalacao_config,w.value=!!s.notificacoes_config}catch(o){console.error("Erro ao carregar workflow:",o)}},B=t=>{(t<=r.value||U.value[t].optional)&&(r.value=t)},I=()=>{r.value<U.length-1&&$.value&&r.value++},O=()=>{r.value>0&&r.value--},S=()=>{const t={id:`estado_${Date.now()}`,tempId:Date.now(),nome:"",descricao:""};a.value.estados.push(t)},j=t=>{const o=a.value.estados[t];a.value.estado_inicial===o.id&&(a.value.estado_inicial=""),a.value.estados_finais=a.value.estados_finais.filter(s=>s!==o.id),a.value.transicoes=a.value.transicoes.filter(s=>s.de!==o.id&&s.para!==o.id),a.value.estados.splice(t,1)},L=t=>{a.value.estado_inicial=t},H=t=>{const o=a.value.estados_finais.indexOf(t);o>-1?a.value.estados_finais.splice(o,1):a.value.estados_finais.push(t)},G=()=>{const t={tempId:Date.now(),de:"",para:"",nome:"",condicao:"",requer_aprovacao:!1,automatica:!1};a.value.transicoes.push(t)},Q=t=>{a.value.transicoes.splice(t,1)},J=()=>{a.value.niveis_aprovacao.push({nome:"",perfil_requerido:"",valor_limite:null})},K=t=>{a.value.niveis_aprovacao.splice(t,1)},X=async()=>{await D(!1)},D=async(t=!0)=>{var o;try{V.value=!0;const s={...a.value,ativo:t,user_id:(o=W.user)==null?void 0:o.id};let u;C.value?u=await E.put(`/workflows/${T.value}`,s):u=await E.post("/workflows",s),u.data.success&&N.push("/workflows")}catch(s){console.error("Erro ao salvar workflow:",s)}finally{V.value=!1}},Y=()=>{f.query.template?N.push("/workflows/templates"):N.push("/workflows")};return ao(()=>{f.params.id&&f.params.id!=="create"&&(C.value=!0,T.value=f.params.id,F(f.params.id)),f.query.template&&P(f.query.template),a.value.estados.length===0&&(S(),S())}),(t,o)=>(i(),n("div",lo,[e("header",to,[e("div",io,[e("div",no,[e("button",{class:"btn-back",onClick:Y},o[14]||(o[14]=[e("i",{class:"lucide-arrow-left"},null,-1)])),e("div",null,[e("h1",null,v(C.value?"Editar Workflow":"Novo Workflow"),1),e("p",ro,v(x.value?`Baseado no template: ${x.value.nome}`:"Criar workflow personalizado"),1)])]),e("div",uo,[e("button",{class:"btn btn-outline",onClick:X,disabled:V.value},o[15]||(o[15]=[e("i",{class:"lucide-save"},null,-1),c(" Salvar Rascunho ",-1)]),8,co),e("button",{class:"btn btn-primary",onClick:D,disabled:V.value||!M.value},[o[16]||(o[16]=e("i",{class:"lucide-check"},null,-1)),c(" "+v(V.value?"Salvando...":C.value?"Atualizar":"Criar"),1)],8,vo)])])]),e("div",po,[e("div",mo,[(i(!0),n(y,null,h(U.value,(s,u)=>(i(),n("div",{key:s.key,class:A(["step",{active:r.value===u,completed:r.value>u,disabled:r.value<u&&!s.optional}]),onClick:l=>B(u)},[e("div",_o,[r.value>u?(i(),n("i",bo)):(i(),n("span",ko,v(u+1),1))]),e("div",go,[e("h4",null,v(s.title),1),e("p",null,v(s.description),1)])],10,fo))),128))]),e("div",wo,[r.value===0?(i(),n("div",yo,[o[30]||(o[30]=e("h2",null,"Informações Básicas",-1)),e("div",ho,[e("div",Vo,[o[17]||(o[17]=e("label",null,"Nome do Workflow *",-1)),d(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>a.value.nome=s),placeholder:"Ex: Aprovação de Ordem de Serviço",required:""},null,512),[[p,a.value.nome]]),o[18]||(o[18]=e("div",{class:"field-hint"},"Nome identificador único para este workflow",-1))]),e("div",xo,[o[19]||(o[19]=e("label",null,"Descrição",-1)),d(e("textarea",{"onUpdate:modelValue":o[1]||(o[1]=s=>a.value.descricao=s),rows:"3",placeholder:"Descreva o propósito e funcionamento deste workflow..."},null,512),[[p,a.value.descricao]])]),e("div",Uo,[o[21]||(o[21]=e("label",null,"Categoria *",-1)),d(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>a.value.categoria=s),required:""},o[20]||(o[20]=[q('<option value="" data-v-a28f920b>Selecione uma categoria</option><option value="operacional" data-v-a28f920b>Operacional</option><option value="financeiro" data-v-a28f920b>Financeiro</option><option value="emergencial" data-v-a28f920b>Emergencial</option><option value="administrativo" data-v-a28f920b>Administrativo</option>',5)]),512),[[_,a.value.categoria]])]),e("div",Co,[o[22]||(o[22]=e("label",null,"Tipo",-1)),d(e("input",{type:"text","onUpdate:modelValue":o[3]||(o[3]=s=>a.value.tipo=s),placeholder:"Ex: aprovacao_ordem_servico"},null,512),[[p,a.value.tipo]])]),e("div",Eo,[o[23]||(o[23]=e("label",null,"Prazo Máximo (horas) *",-1)),d(e("input",{type:"number","onUpdate:modelValue":o[4]||(o[4]=s=>a.value.prazo_maximo=s),min:"1",max:"720",required:""},null,512),[[p,a.value.prazo_maximo,void 0,{number:!0}]])]),e("div",Ao,[o[25]||(o[25]=e("label",null,"Prioridade Padrão",-1)),d(e("select",{"onUpdate:modelValue":o[5]||(o[5]=s=>a.value.prioridade_padrao=s)},o[24]||(o[24]=[e("option",{value:"baixa"},"Baixa",-1),e("option",{value:"normal"},"Normal",-1),e("option",{value:"alta"},"Alta",-1),e("option",{value:"critica"},"Crítica",-1)]),512),[[_,a.value.prioridade_padrao]])]),e("div",No,[o[27]||(o[27]=e("label",null,"Evento Disparador",-1)),d(e("select",{"onUpdate:modelValue":o[6]||(o[6]=s=>a.value.trigger_evento=s)},o[26]||(o[26]=[q('<option value="manual" data-v-a28f920b>Manual</option><option value="criacao_ordem" data-v-a28f920b>Criação de Ordem</option><option value="valor_limite" data-v-a28f920b>Valor Limite</option><option value="mudanca_status" data-v-a28f920b>Mudança de Status</option><option value="prazo_vencimento" data-v-a28f920b>Prazo de Vencimento</option>',5)]),512),[[_,a.value.trigger_evento]])]),e("div",So,[e("label",qo,[d(e("input",{type:"checkbox","onUpdate:modelValue":o[7]||(o[7]=s=>a.value.publico=s)},null,512),[[b,a.value.publico]]),o[28]||(o[28]=e("span",{class:"checkmark"},null,-1)),o[29]||(o[29]=c(" Workflow Público (outros usuários podem usar) ",-1))])])])])):k("",!0),r.value===1?(i(),n("div",To,[e("div",{class:"section-header"},[o[32]||(o[32]=e("h2",null,"Estados do Workflow",-1)),e("button",{class:"btn btn-outline",onClick:S},o[31]||(o[31]=[e("i",{class:"lucide-plus"},null,-1),c(" Adicionar Estado ",-1)]))]),e("div",$o,[(i(!0),n(y,null,h(a.value.estados,(s,u)=>(i(),n("div",{key:s.tempId,class:A(["estado-item",{initial:s.id===a.value.estado_inicial,final:a.value.estados_finais.includes(s.id)}])},[e("div",Do,[e("div",Ro,[s.id===a.value.estado_inicial?(i(),n("i",zo)):a.value.estados_finais.includes(s.id)?(i(),n("i",Wo)):(i(),n("i",Mo))]),e("div",Po,[d(e("input",{"onUpdate:modelValue":l=>s.nome=l,placeholder:"Nome do estado",class:"estado-nome"},null,8,Fo),[[p,s.nome]]),d(e("input",{"onUpdate:modelValue":l=>s.descricao=l,placeholder:"Descrição (opcional)",class:"estado-descricao"},null,8,Bo),[[p,s.descricao]])]),e("div",Io,[e("button",{class:A(["btn-icon",{active:s.id===a.value.estado_inicial}]),onClick:l=>L(s.id),title:"Marcar como estado inicial"},[...o[33]||(o[33]=[e("i",{class:"lucide-play-circle"},null,-1)])],10,Oo),e("button",{class:A(["btn-icon",{active:a.value.estados_finais.includes(s.id)}]),onClick:l=>H(s.id),title:"Marcar como estado final"},[...o[34]||(o[34]=[e("i",{class:"lucide-check-circle"},null,-1)])],10,jo),a.value.estados.length>2?(i(),n("button",{key:0,class:"btn-icon danger",onClick:l=>j(u),title:"Remover estado"},[...o[35]||(o[35]=[e("i",{class:"lucide-trash-2"},null,-1)])],8,Lo)):k("",!0)])])],2))),128))]),o[36]||(o[36]=q('<div class="estados-help" data-v-a28f920b><div class="help-item" data-v-a28f920b><i class="lucide-info" data-v-a28f920b></i><span data-v-a28f920b>Você precisa de pelo menos 2 estados: um inicial e um final</span></div><div class="help-item" data-v-a28f920b><i class="lucide-play-circle" data-v-a28f920b></i><span data-v-a28f920b>Estado inicial: por onde o workflow sempre começa</span></div><div class="help-item" data-v-a28f920b><i class="lucide-check-circle" data-v-a28f920b></i><span data-v-a28f920b>Estados finais: onde o workflow pode terminar</span></div></div>',1))])):k("",!0),r.value===2?(i(),n("div",Ho,[e("div",{class:"section-header"},[o[38]||(o[38]=e("h2",null,"Transições entre Estados",-1)),e("button",{class:"btn btn-outline",onClick:G},o[37]||(o[37]=[e("i",{class:"lucide-plus"},null,-1),c(" Adicionar Transição ",-1)]))]),e("div",Go,[(i(!0),n(y,null,h(a.value.transicoes,(s,u)=>(i(),n("div",{key:s.tempId,class:"transicao-item"},[e("div",Qo,[d(e("select",{"onUpdate:modelValue":l=>s.de=l,class:"estado-select"},[o[39]||(o[39]=e("option",{value:""},"Estado origem",-1)),(i(!0),n(y,null,h(a.value.estados,l=>(i(),n("option",{key:l.id,value:l.id},v(l.nome||`Estado ${l.id}`),9,Ko))),128))],8,Jo),[[_,s.de]]),o[41]||(o[41]=e("div",{class:"arrow"},[e("i",{class:"lucide-arrow-right"})],-1)),d(e("select",{"onUpdate:modelValue":l=>s.para=l,class:"estado-select"},[o[40]||(o[40]=e("option",{value:""},"Estado destino",-1)),(i(!0),n(y,null,h(a.value.estados,l=>(i(),n("option",{key:l.id,value:l.id,disabled:l.id===s.de},v(l.nome||`Estado ${l.id}`),9,Yo))),128))],8,Xo),[[_,s.para]])]),e("div",Zo,[e("div",oe,[e("div",ee,[o[42]||(o[42]=e("label",null,"Nome da Transição",-1)),d(e("input",{"onUpdate:modelValue":l=>s.nome=l,placeholder:"Ex: Aprovar, Rejeitar, Revisar"},null,8,se),[[p,s.nome]])]),e("div",ae,[o[43]||(o[43]=e("label",null,"Condição (opcional)",-1)),d(e("input",{"onUpdate:modelValue":l=>s.condicao=l,placeholder:"Ex: valor > 1000"},null,8,le),[[p,s.condicao]])])]),e("div",te,[e("div",ie,[e("label",ne,[d(e("input",{type:"checkbox","onUpdate:modelValue":l=>s.requer_aprovacao=l},null,8,de),[[b,s.requer_aprovacao]]),o[44]||(o[44]=e("span",{class:"checkmark"},null,-1)),o[45]||(o[45]=c(" Requer Aprovação ",-1))])]),e("div",re,[e("label",ue,[d(e("input",{type:"checkbox","onUpdate:modelValue":l=>s.automatica=l},null,8,ce),[[b,s.automatica]]),o[46]||(o[46]=e("span",{class:"checkmark"},null,-1)),o[47]||(o[47]=c(" Transição Automática ",-1))])]),e("div",ve,[e("button",{class:"btn btn-outline btn-sm",onClick:l=>Q(u),title:"Remover transição"},[...o[48]||(o[48]=[e("i",{class:"lucide-trash-2"},null,-1)])],8,pe)])])])]))),128))])])):k("",!0),r.value===3?(i(),n("div",me,[o[69]||(o[69]=e("h2",null,"Configurações Avançadas",-1)),e("div",fe,[o[55]||(o[55]=e("h3",null,"Níveis de Aprovação",-1)),e("div",_e,[(i(!0),n(y,null,h(a.value.niveis_aprovacao,(s,u)=>(i(),n("div",{key:u,class:"nivel-item"},[e("div",be,v(u+1),1),e("div",ke,[e("div",ge,[e("div",we,[o[49]||(o[49]=e("label",null,"Nome do Nível",-1)),d(e("input",{"onUpdate:modelValue":l=>s.nome=l,placeholder:"Ex: Supervisor, Gerente"},null,8,ye),[[p,s.nome]])]),e("div",he,[o[51]||(o[51]=e("label",null,"Perfil Requerido",-1)),d(e("select",{"onUpdate:modelValue":l=>s.perfil_requerido=l},[...o[50]||(o[50]=[e("option",{value:""},"Qualquer perfil",-1),e("option",{value:"tecnico"},"Técnico",-1),e("option",{value:"supervisor"},"Supervisor",-1),e("option",{value:"administrador"},"Administrador",-1)])],8,Ve),[[_,s.perfil_requerido]])]),e("div",xe,[o[52]||(o[52]=e("label",null,"Valor Limite (R$)",-1)),d(e("input",{type:"number","onUpdate:modelValue":l=>s.valor_limite=l,placeholder:"0.00",step:"0.01"},null,8,Ue),[[p,s.valor_limite,void 0,{number:!0}]])]),e("div",Ce,[e("button",{class:"btn btn-outline btn-sm",onClick:l=>K(u),title:"Remover nível"},[...o[53]||(o[53]=[e("i",{class:"lucide-trash-2"},null,-1)])],8,Ee)])])])]))),128)),e("button",{class:"btn btn-outline",onClick:J},o[54]||(o[54]=[e("i",{class:"lucide-plus"},null,-1),c(" Adicionar Nível ",-1)]))])]),e("div",Ae,[o[61]||(o[61]=e("h3",null,"Escalação Automática",-1)),e("div",Ne,[e("div",Se,[e("label",qe,[d(e("input",{type:"checkbox","onUpdate:modelValue":o[8]||(o[8]=s=>g.value=s)},null,512),[[b,g.value]]),o[56]||(o[56]=e("span",{class:"checkmark"},null,-1)),o[57]||(o[57]=c(" Habilitar escalação automática ",-1))])])]),g.value?(i(),n("div",Te,[e("div",$e,[e("div",De,[o[58]||(o[58]=e("label",null,"Tempo para Escalação (horas)",-1)),d(e("input",{type:"number","onUpdate:modelValue":o[9]||(o[9]=s=>a.value.escalacao_config.tempo_escalacao=s),min:"1",max:"72"},null,512),[[p,a.value.escalacao_config.tempo_escalacao,void 0,{number:!0}]])]),e("div",Re,[o[60]||(o[60]=e("label",null,"Escalar Para",-1)),d(e("select",{"onUpdate:modelValue":o[10]||(o[10]=s=>a.value.escalacao_config.escalar_para=s)},o[59]||(o[59]=[e("option",{value:"supervisor"},"Supervisor",-1),e("option",{value:"administrador"},"Administrador",-1),e("option",{value:"setor_responsavel"},"Setor Responsável",-1)]),512),[[_,a.value.escalacao_config.escalar_para]])])])])):k("",!0)]),e("div",ze,[o[68]||(o[68]=e("h3",null,"Notificações",-1)),e("div",We,[e("div",Me,[e("label",Pe,[d(e("input",{type:"checkbox","onUpdate:modelValue":o[11]||(o[11]=s=>w.value=s)},null,512),[[b,w.value]]),o[62]||(o[62]=e("span",{class:"checkmark"},null,-1)),o[63]||(o[63]=c(" Habilitar notificações ",-1))])])]),w.value?(i(),n("div",Fe,[e("div",Be,[e("div",Ie,[e("label",Oe,[d(e("input",{type:"checkbox","onUpdate:modelValue":o[12]||(o[12]=s=>a.value.notificacoes_config.email=s)},null,512),[[b,a.value.notificacoes_config.email]]),o[64]||(o[64]=e("span",{class:"checkmark"},null,-1)),o[65]||(o[65]=c(" Notificações por Email ",-1))])]),e("div",je,[e("label",Le,[d(e("input",{type:"checkbox","onUpdate:modelValue":o[13]||(o[13]=s=>a.value.notificacoes_config.sistema=s)},null,512),[[b,a.value.notificacoes_config.sistema]]),o[66]||(o[66]=e("span",{class:"checkmark"},null,-1)),o[67]||(o[67]=c(" Notificações no Sistema ",-1))])])])])):k("",!0)])])):k("",!0),e("div",He,[e("button",{class:"btn btn-outline",onClick:O,disabled:r.value===0},o[70]||(o[70]=[e("i",{class:"lucide-chevron-left"},null,-1),c(" Anterior ",-1)]),8,Ge),e("div",Qe," Passo "+v(r.value+1)+" de "+v(U.value.length),1),e("button",{class:"btn btn-primary",onClick:I,disabled:r.value===U.value.length-1||!$.value},o[71]||(o[71]=[c(" Próximo ",-1),e("i",{class:"lucide-chevron-right"},null,-1)]),8,Je)])])])]))}},Ze=Z(Ke,[["__scopeId","data-v-a28f920b"],["__file","C:/Manutencao/frontend/src/pages/WorkflowForm.vue"]]);export{Ze as default};
