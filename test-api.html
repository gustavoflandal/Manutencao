<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste API - Sistema de Manuten칞칚o</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; font-family: monospace; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; }
    </style>
</head>
<body>
    <h1>游빍 Teste da API - Sistema de Manuten칞칚o</h1>
    
    <div class="test-section">
        <h3>1. Health Check</h3>
        <button onclick="testHealth()">Testar Health Check</button>
        <div id="health-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>2. Registrar Administrador</h3>
        <input type="text" id="nome" placeholder="Nome" value="Administrador Sistema">
        <input type="email" id="email" placeholder="Email" value="admin@sistema.com">
        <input type="password" id="senha" placeholder="Senha" value="123456">
        <button onclick="registerAdmin()">Registrar</button>
        <div id="register-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>3. Login</h3>
        <input type="email" id="login-email" placeholder="Email" value="admin@sistema.com">
        <input type="password" id="login-senha" placeholder="Senha" value="123456">
        <button onclick="login()">Fazer Login</button>
        <div id="login-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. Listar Usu치rios (Requer Login)</h3>
        <button onclick="listUsers()">Listar Usu치rios</button>
        <div id="users-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>5. Criar Usu치rio (Requer Login)</h3>
        <input type="text" id="new-nome" placeholder="Nome" value="Jo칚o Silva">
        <input type="email" id="new-email" placeholder="Email" value="joao@teste.com">
        <input type="password" id="new-senha" placeholder="Senha" value="123456">
        <select id="new-perfil">
            <option value="solicitante">Solicitante</option>
            <option value="tecnico">T칠cnico</option>
            <option value="supervisor">Supervisor</option>
            <option value="administrador">Administrador</option>
        </select>
        <button onclick="createUser()">Criar Usu치rio</button>
        <div id="create-user-result" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        let authToken = '';

        async function makeRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    headers: {
                        'Content-Type': 'application/json',
                        ...(authToken && { 'Authorization': `Bearer ${authToken}` }),
                        ...options.headers
                    },
                    ...options
                });
                
                const data = await response.json();
                return { success: response.ok, data, status: response.status };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function showResult(elementId, result, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.innerHTML = JSON.stringify(result, null, 2);
            element.parentElement.className = `test-section ${isSuccess ? 'success' : 'error'}`;
        }

        async function testHealth() {
            const result = await makeRequest('/health');
            showResult('health-result', result, result.success);
        }

        async function registerAdmin() {
            const nome = document.getElementById('nome').value;
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;

            const result = await makeRequest('/auth/register', {
                method: 'POST',
                body: JSON.stringify({ nome, email, senha })
            });
            
            showResult('register-result', result, result.success);
        }

        async function login() {
            const email = document.getElementById('login-email').value;
            const senha = document.getElementById('login-senha').value;

            const result = await makeRequest('/auth/login', {
                method: 'POST',
                body: JSON.stringify({ email, senha })
            });

            if (result.success && result.data.data) {
                authToken = result.data.data.accessToken;
                showResult('login-result', { ...result, token_saved: true }, true);
            } else {
                showResult('login-result', result, false);
            }
        }

        async function listUsers() {
            if (!authToken) {
                showResult('users-result', { error: 'Fa칞a login primeiro!' }, false);
                return;
            }

            const result = await makeRequest('/users');
            showResult('users-result', result, result.success);
        }

        async function createUser() {
            if (!authToken) {
                showResult('create-user-result', { error: 'Fa칞a login primeiro!' }, false);
                return;
            }

            const nome = document.getElementById('new-nome').value;
            const email = document.getElementById('new-email').value;
            const senha = document.getElementById('new-senha').value;
            const perfil = document.getElementById('new-perfil').value;

            const result = await makeRequest('/users', {
                method: 'POST',
                body: JSON.stringify({ nome, email, senha, perfil })
            });

            showResult('create-user-result', result, result.success);
        }

        // Teste autom치tico ao carregar
        window.onload = function() {
            console.log('游빍 Interface de teste carregada!');
            console.log('游늸 Backend esperado em:', API_BASE);
        };
    </script>
</body>
</html>
