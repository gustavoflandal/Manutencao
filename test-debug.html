<!DOCTYPE html>
<html>
<head>
    <title>Debug Sistema Manuten√ß√£o</title>
</head>
<body>
    <h1>Debug - Sistema de Manuten√ß√£o</h1>
    
    <h2>1. Limpar localStorage:</h2>
    <button onclick="clearStorage()">Limpar localStorage</button>
    
    <h2>2. Testar Login via JavaScript:</h2>
    <button onclick="testLogin()">Testar Login Admin</button>
    
    <h2>3. Estado Atual:</h2>
    <div id="status"></div>
    
    <h2>4. Logs:</h2>
    <div id="logs" style="background: #f5f5f5; padding: 10px; height: 300px; overflow-y: scroll; font-family: monospace;"></div>

    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            logs.innerHTML += new Date().toLocaleTimeString() + ' - ' + message + '<br>';
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function clearStorage() {
            localStorage.clear();
            log('üóëÔ∏è localStorage limpo');
            updateStatus();
        }

        function updateStatus() {
            const status = document.getElementById('status');
            status.innerHTML = `
                <strong>Access Token:</strong> ${localStorage.getItem('access_token') ? 'Existe' : 'N√£o existe'}<br>
                <strong>Refresh Token:</strong> ${localStorage.getItem('refresh_token') ? 'Existe' : 'N√£o existe'}
            `;
        }

        async function testLogin() {
            log('üîê Testando login...');
            
            try {
                const response = await fetch('http://localhost:3001/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'admin@sistema.com',
                        senha: '123456'
                    })
                });

                const data = await response.json();
                log('üì• Resposta recebida: ' + JSON.stringify(data, null, 2));

                if (data.success) {
                    log('‚úÖ Login bem-sucedido!');
                    log('üë§ Usu√°rio: ' + data.data.user.nome + ' (' + data.data.user.perfil + ')');
                    
                    // Salvar tokens
                    localStorage.setItem('access_token', data.data.accessToken);
                    localStorage.setItem('refresh_token', data.data.refreshToken);
                    log('üíæ Tokens salvos no localStorage');
                    
                    updateStatus();
                } else {
                    log('‚ùå Login falhou: ' + data.message);
                }
            } catch (error) {
                log('üí• Erro: ' + error.message);
            }
        }

        // Atualizar status inicial
        updateStatus();
    </script>
</body>
</html>